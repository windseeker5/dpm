/**
 * SIMPLIFIED BULLETPROOF DROPDOWN FIX v3.0
 * 
 * This CSS file fixes ALL dropdown issues with maximum specificity and nuclear approach.
 * Issues addressed:
 * 1. Multiple dropdowns staying open (handled by JS)
 * 2. Transparent/invisible backgrounds
 * 3. Poor positioning and cut-off dropdowns
 * 4. Header gravatar dropdown positioning
 * 5. KPI card dropdown visibility
 */

/* ===== CORE DROPDOWN STRUCTURE ===== */

/* Ensure dropdown containers have proper positioning */
.dropdown {
    position: relative !important;
}

/* NUCLEAR DROPDOWN MENU VISIBILITY - MAXIMUM SPECIFICITY */
.dropdown-menu,
.dropdown .dropdown-menu,
.card .dropdown-menu,
.table .dropdown-menu,
.navbar .dropdown-menu,
.minipass-header .dropdown-menu {
    position: absolute !important;
    top: 100% !important;
    left: 0 !important;
    z-index: 1070 !important;
    display: none !important;
    min-width: 10rem !important;
    margin: 0 !important;
    font-size: 0.875rem !important;
    color: #1f2937 !important;
    text-align: left !important;
    list-style: none !important;
    background-color: #ffffff !important;
    background-clip: padding-box !important;
    border: 1px solid #d1d5db !important;
    border-radius: 0.375rem !important;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.15), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;
    padding: 0.5rem 0 !important;
}

/* FORCE VISIBILITY FOR SHOWN DROPDOWNS - NUCLEAR APPROACH */
.dropdown-menu.show,
.dropdown.show .dropdown-menu,
.card .dropdown-menu.show,
.card .dropdown.show .dropdown-menu,
.table .dropdown-menu.show,
.table .dropdown.show .dropdown-menu,
.navbar .dropdown-menu.show,
.navbar .dropdown.show .dropdown-menu,
.minipass-header .dropdown-menu.show,
.minipass-header .dropdown.show .dropdown-menu,
body .dropdown-menu.show,
body .dropdown.show .dropdown-menu,
html body .dropdown-menu.show,
html body .dropdown.show .dropdown-menu {
    display: block !important;
    opacity: 1 !important;
    visibility: visible !important;
    transform: none !important;
    pointer-events: auto !important;
    position: absolute !important;
    top: 100% !important;
    left: 0 !important;
    z-index: 9999 !important;
    background-color: #ffffff !important;
    border: 1px solid #d1d5db !important;
    border-radius: 0.375rem !important;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.15), 0 4px 6px -2px rgba(0, 0, 0, 0.05) !important;
    min-width: 10rem !important;
    margin: 0 !important;
    padding: 0.5rem 0 !important;
    color: #1f2937 !important;
    font-size: 0.875rem !important;
}

/* ===== SPECIAL CONTEXTS ===== */

/* Header dropdown positioning */
.minipass-header .dropdown-menu {
    z-index: 2000 !important;
}

/* Header dropdown end alignment - FIXED FOR GRAVATAR */
.minipass-header .dropdown-menu-end {
    right: 0 !important;
    left: auto !important;
}

/* Specific fix for gravatar dropdown positioning */
.minipass-header-user .dropdown-menu,
.minipass-header-user .dropdown-menu.dropdown-menu-end {
    position: absolute !important;
    top: 100% !important;
    right: 0 !important;
    left: auto !important;
    z-index: 2000 !important;
    margin-top: 0.25rem !important;
    transform: translateX(0) !important;
}

/* Ensure gravatar dropdown container has proper positioning */
.minipass-header-user .dropdown {
    position: relative !important;
}

/* Force correct positioning even if other styles interfere */
.minipass-header-user .dropdown.show .dropdown-menu {
    right: 0 !important;
    left: auto !important;
    transform: translateX(0) !important;
}

/* KPI Cards - ensure proper overflow */
.card.dropdown-open,
.card:has(.dropdown.show) {
    position: relative !important;
    overflow: visible !important;
    z-index: 1080 !important;
}

.card .dropdown.show {
    z-index: 1081 !important;
}

.card .dropdown.show .dropdown-menu {
    z-index: 1082 !important;
}

/* Table containers - ensure overflow visible */
.table-responsive {
    overflow: visible !important;
}

.table .dropdown.show {
    z-index: 1071 !important;
}

/* Smooth animation for dropdowns */
.dropdown-menu {
    transition: all 0.1s ease !important;
}

/* Dropdown items styling */
.dropdown-item {
    display: block !important;
    width: 100% !important;
    padding: 0.5rem 1rem !important;
    clear: both !important;
    font-weight: 400 !important;
    color: #1f2937 !important;
    text-align: inherit !important;
    text-decoration: none !important;
    white-space: nowrap !important;
    background-color: transparent !important;
    border: 0 !important;
    transition: all 0.1s ease !important;
}

.dropdown-item:hover,
.dropdown-item:focus {
    color: #1f2937 !important;
    background-color: #f8f9fa !important;
    text-decoration: none !important;
}

/* ===== RIGHT-ALIGNED DROPDOWNS ===== */

.dropdown-menu-end,
.dropdown-menu.dropdown-menu-end {
    right: 0 !important;
    left: auto !important;
}

/* ===== MOBILE FIXES ===== */

@media (max-width: 768px) {
    .dropdown-menu,
    .dropdown-menu.show {
        max-width: calc(100vw - 2rem) !important;
        min-width: 160px !important;
    }
    
    /* Force right alignment on small screens for KPI cards */
    .card .dropdown-menu,
    .card .dropdown-menu.show {
        right: 0 !important;
        left: auto !important;
    }
}

/* ===== ACCESSIBILITY ===== */

.dropdown-toggle:focus {
    outline: 2px solid #0054a6 !important;
    outline-offset: 2px !important;
}

/* ===== NUCLEAR OVERRIDE FOR BROKEN DROPDOWNS ===== */

/* If a dropdown menu has any of these problematic styles, force correct them */
[class*="dropdown-menu"][style*="display: none"].show {
    display: block !important;
}

[class*="dropdown-menu"][style*="opacity: 0"].show {
    opacity: 1 !important;
}

[class*="dropdown-menu"][style*="visibility: hidden"].show {
    visibility: visible !important;
}

/* ===== DEBUGGING (remove in production) ===== */
/*
.dropdown.show {
    outline: 2px solid green !important;
}

.dropdown-menu.show {
    outline: 2px solid blue !important;
}
*/