{#
  Reusable pagination macro following Tabler.io standards

  Usage:
    {% from 'macros/pagination.html' import render_pagination %}
    {{ render_pagination(pagination, current_filters, items) }}

  Parameters:
    - pagination: Flask-SQLAlchemy pagination object
    - current_filters: Dict of current query parameters to preserve (e.g., {'q': 'search', 'status': 'active'})
    - items: Current page's items list (for accurate entry counter)
    - page_param: Optional name of the page parameter (default: 'page'). Use for multi-table pagination (e.g., 'passport_page', 'signup_page')
#}

{% macro render_pagination(pagination, current_filters={}, items=[], page_param='page') %}
  <div class="card-footer d-flex justify-content-between align-items-center">
    {% if pagination and pagination.total > 0 %}
      <span class="text-muted">Showing {{ ((pagination.page - 1) * pagination.per_page) + 1 }} to {{ ((pagination.page - 1) * pagination.per_page) + items|length }} of {{ pagination.total }} entries</span>
      {% if pagination.pages > 1 %}
        <nav aria-label="Page navigation">
          <ul class="pagination pagination-sm mb-0">
            <!-- Previous page -->
            <li class="page-item {{ 'disabled' if not pagination.has_prev }}">
              {% if pagination.has_prev %}
                {% set prev_params = {page_param: pagination.prev_num} %}
                <a class="page-link" href="{{ url_for(request.endpoint, **prev_params|combine(current_filters)) }}" aria-label="Previous">
                  <i class="ti ti-chevron-left"></i>
                </a>
              {% else %}
                <span class="page-link" aria-label="Previous">
                  <i class="ti ti-chevron-left"></i>
                </span>
              {% endif %}
            </li>

            <!-- Page numbers with ellipsis -->
            {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
              {% if page_num %}
                {% if page_num != pagination.page %}
                  <li class="page-item">
                    {% set page_params = {page_param: page_num} %}
                    <a class="page-link" href="{{ url_for(request.endpoint, **page_params|combine(current_filters)) }}">{{ page_num }}</a>
                  </li>
                {% else %}
                  <li class="page-item active">
                    <span class="page-link">{{ page_num }}</span>
                  </li>
                {% endif %}
              {% else %}
                <li class="page-item disabled">
                  <span class="page-link">â€¦</span>
                </li>
              {% endif %}
            {% endfor %}

            <!-- Next page -->
            <li class="page-item {{ 'disabled' if not pagination.has_next }}">
              {% if pagination.has_next %}
                {% set next_params = {page_param: pagination.next_num} %}
                <a class="page-link" href="{{ url_for(request.endpoint, **next_params|combine(current_filters)) }}" aria-label="Next">
                  <i class="ti ti-chevron-right"></i>
                </a>
              {% else %}
                <span class="page-link" aria-label="Next">
                  <i class="ti ti-chevron-right"></i>
                </span>
              {% endif %}
            </li>
          </ul>
        </nav>
      {% endif %}
    {% else %}
      <span class="text-muted">No entries found</span>
    {% endif %}
  </div>
{% endmacro %}
