{% set logo_url = 'cid:logo_image' %}
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="format-detection" content="telephone=no">
  <meta name="x-apple-disable-message-reformatting">
  <title>Minipass Confirmation</title>

  <!--[if mso]>
  <xml>
    <o:OfficeDocumentSettings>
      <o:AllowPNG/>
      <o:PixelsPerInch>96</o:PixelsPerInch>
    </o:OfficeDocumentSettings>
  </xml>
  <![endif]-->

  <style type="text/css">
    /* V5: Mobile-first CSS with improved margins and QR sizes */
    @media only screen and (max-width: 600px) {
      .main-table {
        width: 100% !important;
        min-width: 320px !important;
        margin: 16px auto !important;
      }
      .container {
        width: 100% !important;
        max-width: 100% !important;
        padding: 0 !important;
      }
      .hero-image {
        width: 100% !important;
        height: auto !important;
        max-width: 156px !important;
      }
      /* V5: Reduced mobile margins from 75px to 16px */
      .content-padding {
        padding: 0 16px 20px 16px !important;
      }
      .intro-padding {
        padding: 16px 16px 20px 16px !important;
      }
      .conclusion-padding {
        padding: 0 16px 24px 16px !important;
      }
      /* V5: QR code 2x size on mobile (400px) */
      .qr-code {
        width: 400px !important;
        height: 400px !important;
        max-width: 90% !important;
      }
      .footer-table {
        width: 100% !important;
        padding: 0 16px !important;
      }
      .footer-text {
        padding: 0 16px 16px 16px !important;
        font-size: 12px !important;
      }
      /* V5: Larger mobile font sizes */
      .mobile-font-size {
        font-size: 16px !important;
        line-height: 1.6 !important;
      }
      .mobile-title {
        font-size: 24px !important;
        padding-bottom: 16px !important;
      }
      /* V5: Unified QR card same width as other cards */
      .qr-unified-card {
        width: 100% !important;
      }
      .qr-card-text {
        font-size: 14px !important;
      }
    }

    @media only screen and (max-width: 480px) {
      .qr-code {
        width: 350px !important;
        height: 350px !important;
        max-width: 90% !important;
      }
      .hero-container {
        padding: 24px 0 16px 0 !important;
      }
    }
  </style>

  <!--[if mso]>
  <style type="text/css">
    .main-table {
      width: 600px !important;
    }
  </style>
  <![endif]-->
</head>
<body style="margin:0; padding:0; background-color:#f5f6fa; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; font-size: 16px; color: #4b5563; -webkit-text-size-adjust: none; -ms-text-size-adjust: none;">
  <table width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color:#f5f6fa; min-width: 100%;">
    <tr>
      <td align="center" style="padding: 0;">

        <!-- Outer Card Container -->
        <table class="main-table" width="600" cellpadding="0" cellspacing="0" border="0" style="background-color:#ffffff; border-radius: 8px; overflow:hidden; margin: 40px auto; max-width: 600px;">

          <!-- Hero Image Section -->
          <tr>
            <td class="hero-container" align="center" style="padding: 40px 0 20px; line-height: 0;">
              <img class="hero-image" src="cid:hand-rock" alt="Participation confirmée" width="152" style="display: block; width: 152px; max-width: 100%; height: auto; border: 0; outline: none; text-decoration: none;">
            </td>
          </tr>

          <!-- Dynamic Title -->
          {% if title %}
          <tr>
            <td class="mobile-title" align="center" style="font-size: 20px; font-weight: bold; color: #232b38; padding: 40px 20px 16px 20px;">
              {{ title }}
            </td>
          </tr>
          {% endif %}

          <!-- Intro Text - V5: Updated padding and font size -->
          {% if intro_text %}
          <tr>
            <td class="intro-padding mobile-font-size" style="padding: 16px 40px 24px; font-size: 16px; color: #475569; text-align: left; line-height: 1.6;">
              {{ intro_text | safe }}
            </td>
          </tr>
          {% endif %}

          <!-- V5: Owner Card FIRST (moved before QR) -->
          <tr>
            <td class="content-padding" style="padding: 0 40px 24px;">
              {{ owner_html | safe }}
            </td>
          </tr>

          <!-- V5: Unified Instruction + QR Card (white bg, gray border) -->
          <tr>
            <td class="content-padding" style="padding: 0 40px 24px;">
              <table class="qr-unified-card" width="100%" cellpadding="0" cellspacing="0" border="0" style="background-color: #ffffff; border: 1px solid #e2e8f0; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.08);">
                <tr>
                  <td style="padding: 24px 20px;">
                    <table width="100%" cellpadding="0" cellspacing="0" border="0">
                      <!-- Instruction text only -->
                      <tr>
                        <td align="center" style="padding-bottom: 20px;">
                          <p class="qr-card-text" style="margin: 0; font-size: 15px; color: #475569; line-height: 1.5;">
                            Présentez ce code QR lors de votre prochaine participation.
                          </p>
                        </td>
                      </tr>
                      <!-- QR Code - V6: 350px desktop, NO border -->
                      <tr>
                        <td align="center">
                          <img class="qr-code" src="cid:qr_code" alt="QR Code" width="350" height="350" style="display: block; background: #fff;">
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
              </table>
            </td>
          </tr>

          <!-- History Table -->
          <tr>
            <td class="content-padding" style="padding: 0 40px 24px;">
              {{ history_html | safe }}
            </td>
          </tr>

          <!-- Conclusion Text - V5: Updated padding and font size -->
          {% if conclusion_text %}
          <tr>
            <td class="conclusion-padding mobile-font-size" style="padding: 0 40px 40px; font-size: 16px; color: #475569; text-align: left; line-height: 1.6;">
              {{ conclusion_text | safe }}
            </td>
          </tr>
          {% endif %}



        </table>

        <!-- Legal Compliance Footer -->
        <table width="600" cellpadding="0" cellspacing="0" border="0" style="margin: 0 auto;">
          <tr>
            <td align="center" style="font-size: 13px; color: #6b7280; padding: 20px 32px;">
              <p style="margin: 0 0 10px 0;">Pour toute question, contactez-nous à
                <a href="mailto:{{ support_email }}" style="color:#3b82f6; text-decoration:none;">{{ support_email }}</a>
              </p>
              <p style="margin: 5px 0; color:#6b7280; font-size: 12px;">
                {{ organization_name }} • {{ organization_address }}
              </p>
              <p style="margin: 10px 0; font-size: 12px;">
                <a href="{{ unsubscribe_url }}" style="color:#3b82f6; text-decoration:none;">Se désabonner</a> |
                <a href="{{ privacy_url }}" style="color:#3b82f6; text-decoration:none;">Politique de confidentialité</a>
              </p>
              <p style="margin: 5px 0; color:#94a3b8; font-size: 11px;">
                Vous recevez ce courriel car vous êtes inscrit à {{ activity_name }}
              </p>
              <p style="color:#94a3b8; margin: 10px 0 0 0; font-size: 11px;">
                © 2025 {{ organization_name }}. Tous droits réservés.
              </p>
            </td>
          </tr>
        </table>

      </td>
    </tr>
  </table>
</body>
</html>