{% extends "base.html" %}
{% block title %}Subscription | Minipass{% endblock %}
{% block content %}

<div class="page-wrapper">
  <!-- Page Header -->
  <div class="page-header d-print-none" style="padding-top: 2rem;">
    <div class="dashboard-container">
      <div class="row g-2 align-items-center">
        <div class="col">
          <h1 class="page-title"><i class="ti ti-credit-card text-orange me-2"></i>Subscription</h1>
        </div>
      </div>
    </div>
  </div>

  <!-- Page Body -->
  <div class="page-body">
    <div class="dashboard-container">

      <!-- Subscription Card - Compact -->
      <div class="card" style="max-width: 650px;">
        <div class="card-body p-3">

          <!-- Plan -->
          <div class="row mb-2 align-items-center">
            <div class="col-sm-3 text-muted"><i class="ti ti-package me-1" style="color: #667085;"></i>Plan</div>
            <div class="col-sm-9 fw-bold">
              {{ tier_info.name }}
              {% if not subscription_meta.is_paid_subscriber %}
              <span class="badge bg-azure-lt ms-2">Beta</span>
              {% endif %}
              {% if subscription_meta.is_paid_subscriber and subscription_meta.billing_frequency %}
              <span class="text-muted fw-normal ms-2">({{ subscription_meta.billing_frequency|capitalize }})</span>
              {% endif %}
            </div>
          </div>

          <!-- Activities -->
          <div class="row mb-2 align-items-center">
            <div class="col-sm-3 text-muted"><i class="ti ti-activity me-1" style="color: #667085;"></i>Activities</div>
            <div class="col-sm-9">
              {{ usage_info.current }} / {{ usage_info.limit }}
              <span class="text-muted ms-2">
                {% if usage_info.percentage >= 100 %}
                (Limit reached)
                {% else %}
                ({{ usage_info.limit - usage_info.current }} remaining)
                {% endif %}
              </span>
            </div>
          </div>

          {% if subscription_meta.is_paid_subscriber %}
          <!-- Next Billing Date -->
          <div class="row mb-2 align-items-center">
            <div class="col-sm-3 text-muted"><i class="ti ti-calendar me-1" style="color: #667085;"></i>Next billing</div>
            <div class="col-sm-9">{{ subscription_meta.renewal_date or 'N/A' }}</div>
          </div>

          <!-- Amount -->
          <div class="row mb-2 align-items-center">
            <div class="col-sm-3 text-muted"><i class="ti ti-currency-dollar me-1" style="color: #667085;"></i>Amount</div>
            <div class="col-sm-9">${{ subscription_meta.payment_amount or '0' }} CAD</div>
          </div>

          <!-- Status -->
          <div class="row mb-2 align-items-center">
            <div class="col-sm-3 text-muted"><i class="ti ti-circle-check me-1" style="color: #667085;"></i>Status</div>
            <div class="col-sm-9"><span class="badge bg-success-lt">Active</span></div>
          </div>

          <hr class="my-2">

          <!-- Cancel Auto-Renewal -->
          <div class="row align-items-center">
            <div class="col-sm-3 text-muted"><i class="ti ti-refresh me-1" style="color: #667085;"></i>Auto-renewal</div>
            <div class="col-sm-9">
              {% if subscription_details and subscription_details.cancel_at_period_end %}
                <span class="badge bg-warning-lt">Cancelled</span>
                <span class="text-muted ms-2">Subscription ends {{ subscription_meta.renewal_date }}</span>
              {% else %}
                <form method="POST" class="d-inline">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <input type="hidden" name="action" value="cancel">
                  <button type="submit" class="btn btn-danger">Unsubscribe</button>
                </form>
              {% endif %}
            </div>
          </div>

          {% else %}
          <!-- Beta Tester Status -->
          <div class="row mb-2 align-items-center">
            <div class="col-sm-3 text-muted"><i class="ti ti-heart me-1" style="color: #667085;"></i>Status</div>
            <div class="col-sm-9">
              <span class="badge bg-azure-lt">Beta Tester</span>
              <span class="text-muted ms-2">Thank you for helping us build MiniPass!</span>
            </div>
          </div>
          {% endif %}

        </div>
      </div>

    </div>
  </div>
</div>

{% endblock %}
