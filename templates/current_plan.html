{% extends "base.html" %}
{% block title %}Subscription | Minipass{% endblock %}
{% block content %}

<div class="page-wrapper">
  <div class="page-body">
    <div class="dashboard-container">

      <!-- Single Elegant Card -->
      <div class="card bg-white" style="max-width: 800px; margin: 2rem auto;">
        <div class="card-header">
          <h2 class="card-title mb-0">
            <i class="ti ti-credit-card me-2" style="color: #206bc4;"></i>Subscription
          </h2>
        </div>
        <div class="card-body">

          <!-- Plan Info - Compact Grid -->
          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <div class="text-muted small">PLAN</div>
              <div class="h3 mb-0">
                {{ tier_info.name }}
                {% if not subscription_meta.is_paid_subscriber %}
                <span class="badge bg-azure-lt ms-2">Beta</span>
                {% endif %}
              </div>
              {% if subscription_meta.is_paid_subscriber and subscription_meta.billing_frequency %}
              <div class="text-muted small mt-1">{{ subscription_meta.billing_frequency|capitalize }} billing</div>
              {% endif %}
            </div>
            <div class="col-md-6">
              <div class="text-muted small">ACTIVITIES</div>
              <div class="h3 mb-0">{{ usage_info.current }} / {{ usage_info.limit }}</div>
              <div class="text-muted small mt-1">
                {% if usage_info.percentage >= 100 %}
                  <i class="ti ti-alert-triangle text-danger me-1"></i>Limit reached
                {% else %}
                  {{ usage_info.limit - usage_info.current }} remaining
                {% endif %}
              </div>
            </div>
          </div>

          <!-- Subscription Details (Paid Only) -->
          {% if subscription_meta.is_paid_subscriber %}
          <hr>
          <div class="row g-3 mb-4">
            <div class="col-md-4">
              <div class="text-muted small">RENEWAL DATE</div>
              <div class="fw-bold">{{ subscription_meta.renewal_date or 'N/A' }}</div>
            </div>
            <div class="col-md-4">
              <div class="text-muted small">AMOUNT</div>
              <div class="fw-bold">${{ subscription_meta.payment_amount or '0' }} CAD</div>
            </div>
            <div class="col-md-4">
              <div class="text-muted small">STATUS</div>
              <div class="fw-bold"><span class="badge bg-success-lt">Active</span></div>
            </div>
          </div>

          <hr>

          <!-- Cancel Subscription -->
          <div class="d-flex align-items-center justify-content-between">
            <div>
              <div class="fw-bold">Cancel Auto-Renewal</div>
              <div class="text-muted small">Your access continues until {{ subscription_meta.renewal_date }}</div>
            </div>
            <form method="POST" class="ms-3">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <input type="hidden" name="action" value="cancel">
              <button type="submit" class="btn btn-outline-danger">
                <i class="ti ti-ban me-1"></i>Unsubscribe
              </button>
            </form>
          </div>
          {% else %}
          <!-- Beta Tester Message -->
          <hr>
          <div class="alert alert-info mb-0">
            <div class="d-flex align-items-center">
              <i class="ti ti-heart me-3" style="font-size: 2rem;"></i>
              <div>
                <div class="fw-bold">Thank you for beta testing!</div>
                <div class="text-muted">You're helping us build MiniPass. We appreciate your support!</div>
              </div>
            </div>
          </div>
          {% endif %}

        </div>
      </div>

    </div>
  </div>
</div>

{% endblock %}

{% block head %}
<style>
.dashboard-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 1.5rem;
}

.card {
  background: #fff !important;
  border: none !important;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05) !important;
  border-radius: 0.5rem !important;
}
</style>
{% endblock %}
