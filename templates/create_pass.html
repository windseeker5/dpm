{% extends "base.html" %}

{% block title %}Create New Pass{% endblock %}

{% block header %}Create New Pass{% endblock %}

{% block content %}


<h2>Create a new pass ğŸŸï¸</h2>

<form action="{{ url_for('create_pass') }}" method="POST">


    <!-- User Name Input with Custom Suggestions -->
    <div class="form_row">

        <div class="input-field">
        <input type="text" name="user_name" id="user_name" autocomplete="off" required>
        <label for="user_name">User Name</label>
        </div>
    
        <!-- Suggestions container -->
        <ul id="suggestions" class="suggestion-box"></ul>

    </div>



    <div class="form_row">

        <label for="user_email">User Email:</label>
        <input type="email" name="user_email" id="user_email" required>

    </div>


    <div class="form_row">

        <label for="mobile_phone">Mobile Phone:</label>
        <input type="tel" name="phone_number" id="mobile_phone" placeholder="e.g. 123-456-7890">

    </div>
    


    <div class="form_row">

        <label for="sold_amt">Sold Amount ($):</label>
        <input type="number" name="sold_amt" id="sold_amt" value="{{ default_amt }}" min="0" step="1">

    </div>

    <div class="form_row">

        <label for="sessionsQt">Sessions number:</label>
        <input type="number" name="sessionsQt" id="sessionsQt" value="{{ default_qt }}" min="1" step="1">
    
    </div>


 
    <div class="form_row">

        <button type="submit" class="btn waves-effect">
            Create Pass
        </button>  
          
    </div>


</form>





<!-- âœ… Working Auto-suggest & Autofill -->
<script>
    let userCache = [];

    document.addEventListener("DOMContentLoaded", async () => {
        const nameInput = document.getElementById("user_name");
        const emailInput = document.getElementById("user_email");
        const phoneInput = document.getElementById("mobile_phone");
        const suggestionBox = document.getElementById("suggestions");

        try {
            const response = await fetch("/users.json");
            if (!response.ok) throw new Error("Failed to load users");
            userCache = await response.json();
        } catch (err) {
            console.error("âŒ Failed to load user cache:", err);
            return;
        }

        nameInput.addEventListener("input", () => {
            const input = nameInput.value.trim().toLowerCase();
            if (input.length < 2) {
                suggestionBox.style.display = "none";
                return;
            }

            const matches = userCache.filter(user =>
                user.name && user.name.toLowerCase().startsWith(input)
            ).slice(0, 5);

            suggestionBox.innerHTML = "";
            if (matches.length > 0) {
                matches.forEach(user => {
                    const li = document.createElement("li");
                    li.textContent = user.name;
                    li.dataset.email = user.email;
                    li.dataset.phone = user.phone;
                    li.addEventListener("click", () => {
                        nameInput.value = user.name;
                        emailInput.value = user.email;
                        phoneInput.value = user.phone;
                        suggestionBox.style.display = "none";
                    });
                    suggestionBox.appendChild(li);
                });
                suggestionBox.style.display = "block";
            } else {
                suggestionBox.style.display = "none";
            }
        });

        document.addEventListener("click", (e) => {
            if (!suggestionBox.contains(e.target) && e.target !== nameInput) {
                suggestionBox.style.display = "none";
            }
        });
    });
</script>







{% endblock %}
