{% extends "base.html" %}
{% block title %}E-Bank Reporting{% endblock %}

{% block content %}
<style>
    /* Hide columns on screens smaller than 1400px width */
    @media (max-width: 1399px) {
      .pass-table th:nth-child(2), /* From */
      .pass-table td:nth-child(2),
  
      .pass-table th:nth-child(5), /* Pass Name */
      .pass-table td:nth-child(5),
  
      .pass-table th:nth-child(6), /* Pass ID */
      .pass-table td:nth-child(6),
  
      .pass-table th:nth-child(7), /* Score */
      .pass-table td:nth-child(7),
  
      .pass-table th:nth-child(8), /* Result */
      .pass-table td:nth-child(8) {
        display: none;
      }
    }
  </style>

<div class="container z-depth-1" style="background: white; padding: 30px; border-radius: 20px; margin-top: 30px; margin-bottom: 30px;">
  <h4 class="center-align">Matched E-Payments</h4>

  <div class="search-bar-container">
    <i class="material-icons search-icon">search</i>
    <input type="text" id="searchInput" class="search-input" placeholder="Search all records..." value="{{ search }}">
  </div>

  <div class="responsive-table">
    <table class="pass-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>From</th>
          <th>Bank Name</th>
          <th>Amount</th>
          <th>Pass Name</th>
          <th>Pass ID</th>
          <th>Score</th>
          <th>Result</th>
          <th>Paid?</th>
        </tr>
      </thead>

        <tbody>
            {% for log in ebank_logs %}
            <tr>
              <td>{{ log.timestamp.strftime('%Y-%m-%d %H:%M') }}</td>
              <td>{{ log.from_email }}</td>
              <td>{{ log.bank_info_name }}</td>
              <td>${{ "%.2f"|format(log.bank_info_amt) }}</td>
              <td>{{ log.matched_name }}</td>
              <td>{{ log.matched_pass_id or '-' }}</td>
              <td>{{ "%.2f"|format(log.name_score) }}</td>
              <td>{{ log.result }}</td>
              <td style="color: green; font-size: 20px;">✔️</td>
            </tr>
            {% endfor %}
        </tbody>


    </table>
  </div>

  {% if pagination.pages > 1 %}
  <ul class="pagination center-align">
    {% for p in range(1, pagination.pages + 1) %}
    <li class="waves-effect {% if pagination.page == p %}active{% endif %}">
      <a href="{{ url_for('reporting', page=p, search=search) }}">{{ p }}</a>
    </li>
    {% endfor %}
  </ul>
  {% endif %}
</div>

<script>
  document.getElementById("searchInput").addEventListener("keydown", function (e) {
    if (e.key === "Enter") {
      const search = encodeURIComponent(this.value);
      window.location.href = `?search=${search}`;
    }
  });
</script>
{% endblock %}