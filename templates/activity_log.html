{% extends "base.html" %}
{% block title %}Activity Log{% endblock %}

{% block content %}

<div class="page-wrapper">
  <!-- Page Header -->
  <div class="page-header d-print-none" style="padding-top: 2rem;">
    <div class="dashboard-container">
      <h2 class="mb-0">
        <i class="ti ti-history me-2" style="color: #206bc4;"></i>Activity Log
      </h2>
    </div>
  </div>

  <!-- Page Body -->
  <div class="page-body">
    <div class="dashboard-container">

    <!-- ðŸ”¹ Search + Filter Controls -->
    <div class="card mb-3">
    <div class="card-body">
      <form method="get" action="{{ url_for('activity_log') }}">
        <div class="row g-2 align-items-center">
          <!-- Dropdown Filter -->
          <div class="col-md-3">
            <select name="type" class="form-select" onchange="this.form.submit()">
              <option value="">All Types</option>
              <option value="Passport Created" {% if current_filters.type == 'Passport Created' %}selected{% endif %}>Passport Created</option>
              <option value="Passport Redeemed" {% if current_filters.type == 'Passport Redeemed' %}selected{% endif %}>Passport Redeemed</option>
              <option value="Email Sent" {% if current_filters.type == 'Email Sent' %}selected{% endif %}>Email Sent</option>
              <option value="Payment Matched" {% if current_filters.type == 'Payment Matched' %}selected{% endif %}>Payment Matched</option>
              <option value="Marked Paid" {% if current_filters.type == 'Marked Paid' %}selected{% endif %}>Marked Paid</option>
              <option value="Reminder Sent" {% if current_filters.type == 'Reminder Sent' %}selected{% endif %}>Reminder Sent</option>
              <option value="Signup Submitted" {% if current_filters.type == 'Signup Submitted' %}selected{% endif %}>Signup Submitted</option>
              <option value="Signup Approved" {% if current_filters.type == 'Signup Approved' %}selected{% endif %}>Signup Approved</option>
              <option value="Signup Rejected" {% if current_filters.type == 'Signup Rejected' %}selected{% endif %}>Signup Rejected</option>
              <option value="Activity Created" {% if current_filters.type == 'Activity Created' %}selected{% endif %}>Activity Created</option>
              <option value="Admin Action" {% if current_filters.type == 'Admin Action' %}selected{% endif %}>Admin Action</option>
            </select>
          </div>

          <!-- Search Input -->
          <div class="col-md">
            <div class="input-icon">
              <span class="input-icon-addon">
                <i class="ti ti-search"></i>
              </span>
              <input type="text" name="q" class="form-control" placeholder="Search logs..." value="{{ current_filters.q }}">
            </div>
          </div>

          <!-- Search Button -->
          <div class="col-md-auto">
            <button type="submit" class="btn btn-primary">
              <i class="ti ti-search me-1"></i> Search
            </button>
            {% if current_filters.q or current_filters.type %}
            <a href="{{ url_for('activity_log') }}" class="btn btn-link">Clear</a>
            {% endif %}
          </div>
        </div>
      </form>
    </div>
  </div>

    <!-- ðŸ”¹ Table / Cards Container -->
    <div class="card">
    <div class="card-header">
      <h3 class="card-title">Last Transactions</h3>
    </div>

    <!-- Desktop Table View (hidden on mobile) -->
    <div class="d-none d-md-block">
      <div class="table-responsive">
        <table class="table card-table table-vcenter" id="logTable">
          <thead>
            <tr>
              <th scope="col" class="text-muted">Date/Time</th>
              <th scope="col" class="text-muted">Type</th>
              <th scope="col" class="text-muted">Description</th>
            </tr>
          </thead>
          <tbody>
            {% for log in logs %}
            <tr data-type="{{ log.type }}">
              <td>{{ log.timestamp | utc_to_local | datetimeformat('%Y-%m-%d %H:%M') }}</td>
              <td>
                {% if log.type == 'Passport Redeemed' %}
                  <i class="ti ti-ticket text-danger"></i>
                {% elif log.type == 'Email Sent' %}
                  <i class="ti ti-mail text-info"></i>
                {% elif log.type == 'Passport Created' %}
                  <i class="ti ti-id text-lime"></i>
                {% elif log.type == 'Interact Payment' %}
                  <i class="ti ti-currency-dollar text-success"></i>
                {% elif log.type == 'Marked Paid' %}
                  <i class="ti ti-check text-green"></i>
                {% elif log.type == 'Reminder Sent' %}
                  <i class="ti ti-bell text-purple"></i>
                {% elif log.type == 'Signup Submitted' %}
                  <i class="ti ti-user-plus text-success"></i>
                {% elif log.type == 'Signup Approved' %}
                  <i class="ti ti-user-check text-green"></i>
                {% elif log.type == 'Signup Rejected' %}
                  <i class="ti ti-user-x text-danger"></i>
                {% elif log.type == 'Signup Cancelled' %}
                  <i class="ti ti-user-x text-danger"></i>
                {% elif log.type == 'Activity Created' %}
                  <i class="ti ti-target text-orange"></i>
                {% elif log.type == 'Admin Action' %}
                  <i class="ti ti-settings text-muted"></i>
                {% else %}
                  <i class="ti ti-activity text-muted"></i>
                {% endif %}
                {{ log.type }}
              </td>
              <td class="log-description">{{ log.details }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Mobile Card View (hidden on desktop) -->
    <div class="d-md-none" id="mobileLogCards">
      {% for log in logs %}
      <div class="log-card-mobile" data-type="{{ log.type }}">
        <div class="log-card-badges mb-2">
          <span class="badge badge-sm bg-gray-lt me-2">{{ log.timestamp | utc_to_local | datetimeformat('%Y-%m-%d') }}</span>
          <span class="badge badge-sm bg-{{ log.type | log_type_color }}-lt">{{ log.type }}</span>
        </div>
        <div class="log-card-description">{{ log.details }}</div>
      </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% from 'macros/pagination.html' import render_pagination %}
    {{ render_pagination(pagination, current_filters, logs) }}
    </div>

    </div>
  </div>
</div>
{% endblock %}
