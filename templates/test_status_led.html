<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Status LED Test | Minipass</title>
    <link href="{{ url_for('static', filename='tabler/css/tabler.min.css') }}" rel="stylesheet">
    <style>
        /* Status LED Styles */
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.5rem 1rem;
            background: rgba(16, 185, 129, 0.1);
            border-radius: 16px;
            font-size: 0.875rem;
            color: #059669;
            margin: 1rem;
            width: fit-content;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
            transition: background-color 0.3s ease;
        }

        /* Status LED States */
        .status-dot.connected {
            background: #10b981;
            animation: pulse 2s infinite;
        }

        .status-dot.disconnected {
            background: #6b7280;
            animation: none;
        }

        .status-dot.checking {
            background: #f59e0b;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .demo-controls {
            margin: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .model-selector {
            margin: 1rem;
            min-width: 200px;
        }
    </style>
</head>
<body>
    <div class="page page-center">
        <div class="container-tight py-4">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Status LED Test</h3>
                </div>
                <div class="card-body">
                    <h4>Status Indicator Demo</h4>
                    <p>This demonstrates the colored status LED indicator for the chatbot model connectivity.</p>
                    
                    <!-- Status Indicator -->
                    <div class="status-indicator">
                        <span class="status-dot connected" id="statusDot"></span>
                        <span id="statusText">Ready</span>
                    </div>
                    
                    <!-- Model Selector -->
                    <div class="model-selector">
                        <label class="form-label">Model:</label>
                        <select class="form-select" id="modelSelector">
                            <option value="simple-model">Simple Model</option>
                            <option value="llama2">Llama 2</option>
                            <option value="codellama">Code Llama</option>
                            <option value="mistral">Mistral</option>
                            <option value="nonexistent-model">Unavailable Model</option>
                        </select>
                    </div>
                    
                    <!-- Demo Controls -->
                    <div class="demo-controls">
                        <button class="btn btn-primary" onclick="updateStatusIndicator('Connected', 'connected')">
                            Connected (Green)
                        </button>
                        <button class="btn btn-warning" onclick="updateStatusIndicator('Checking...', 'checking')">
                            Checking (Yellow)
                        </button>
                        <button class="btn btn-secondary" onclick="updateStatusIndicator('Disconnected', 'disconnected')">
                            Disconnected (Gray)
                        </button>
                        <button class="btn btn-success" onclick="demoModelChange()">
                            Demo Model Change
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update status indicator
        function updateStatusIndicator(status, state = 'connected') {
            const statusText = document.getElementById('statusText');
            const statusDot = document.getElementById('statusDot');
            
            if (statusText) {
                statusText.textContent = status;
            }
            
            if (statusDot) {
                // Remove all status classes
                statusDot.className = 'status-dot';
                
                // Add appropriate status class
                if (state === 'checking') {
                    statusDot.classList.add('checking');
                } else if (state === 'disconnected') {
                    statusDot.classList.add('disconnected');
                } else {
                    statusDot.classList.add('connected');
                }
            }
        }

        // Check model availability (simulation)
        async function checkModelAvailability(modelName) {
            try {
                updateStatusIndicator('Checking...', 'checking');
                
                // Simulate checking delay
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // Simulate model availability based on model name
                const availableModels = ['simple-model', 'llama2', 'codellama', 'mistral'];
                const isAvailable = availableModels.includes(modelName);
                
                if (isAvailable) {
                    updateStatusIndicator('Connected', 'connected');
                    return true;
                } else {
                    updateStatusIndicator('Disconnected', 'disconnected');
                    return false;
                }
            } catch (error) {
                console.error('Model check failed:', error);
                updateStatusIndicator('Disconnected', 'disconnected');
                return false;
            }
        }

        // Handle model selector changes
        function handleModelChange() {
            const modelSelector = document.getElementById('modelSelector');
            const selectedModel = modelSelector.value;
            
            console.log('Model changed to:', selectedModel);
            
            // Check model availability
            checkModelAvailability(selectedModel);
        }

        // Demo model change function
        function demoModelChange() {
            const modelSelector = document.getElementById('modelSelector');
            const models = ['simple-model', 'llama2', 'nonexistent-model', 'mistral'];
            let currentIndex = 0;
            
            function cycleModel() {
                if (currentIndex < models.length) {
                    modelSelector.value = models[currentIndex];
                    handleModelChange();
                    currentIndex++;
                    setTimeout(cycleModel, 2000);
                }
            }
            
            cycleModel();
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            // Handle model selector changes
            const modelSelector = document.getElementById('modelSelector');
            if (modelSelector) {
                modelSelector.addEventListener('change', handleModelChange);
                
                // Check initial model availability
                if (modelSelector.value) {
                    setTimeout(() => {
                        checkModelAvailability(modelSelector.value);
                    }, 100);
                }
            }
        });
    </script>
</body>
</html>